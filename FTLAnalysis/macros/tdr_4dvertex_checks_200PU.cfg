<draw>
#plots n_vtxs_4D_vs_3D n_vtxs_4D_over_3D n_vtxs_4D_over_3D_vs_ntrks \
#      sumpt2_vtx0_dzdt sumpt2_vtx0_score sumpt2_vtx0_score_comp \      
#      track_dt_over_sigmat track_dt_over_sigmat_vs_pt

# plots track_pu_vs_linden_wp80 track_pu_vs_linden_wp90 track_pu_vs_linden_wp95 \
#       track_eff_vs_linden_wp80 track_eff_vs_linden_wp90 track_eff_vs_linden_wp95 \
#       track_pu_vs_linden_wp90_barrel track_eff_vs_linden_wp90_barrel \
#       track_pu_vs_linden_wp90_endcap track_eff_vs_linden_wp90_endcap

saveAs pdf png root
plugins 'rootlogon.C' 'gStyle->SetOptStat("")' \
        '$CMSSW_BASE/src/ExternalTools/FuriousPlotter/scripts/macros/FPCanvasStyle.C'
outDir '/eos/user/s/spigazzi/www/precision_timing/TDR/tracking/track_puid_PMV11_v7/200PU/'
</draw>

input /eos/user/s/spigazzi/ntuples/MTD/TDR/track_reco/ttbar_PMV11_4dstudies_v4.root vtxs_tree
input_trks /eos/user/s/spigazzi/ntuples/MTD/TDR/track_reco/ttbar_PMV11_4dstudies_v7.root trks_tree 

<n_vtxs_4D_vs_3D>
customize 'SetLogz()' 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1, 1)'
histos map
<map>
        src= input
        var 'vtx4D_n_good:vtx3D_n_good'
        cut '1./Entries$'
        bins 100 100.5 200.5 100 100.5 200.5
        customize 'SetTitle(";N_{vtxs} 3D;N_{vtxs} 4D;Fraction of events")' 'macro:gStyle->SetPaintTextFormat(".3f")' 'SetContour(10000)' 'SetMinimum(0.0001)'
        drawOptions COLZ        
</map>
</n_vtxs_4D_vs_3D>

<n_vtxs_4D_over_3D>
customize 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
histos hist
<hist>
        src= input
        var 'vtx4D_n_good/vtx3D_n_good'
        cut '1./Entries$'
        bins 100 0 3
        customize 'SetTitle(";N_{vtxs} 4D/N_{vtxs} 3D;Fraction of events")' 'SetLineColor(kBlue+1)' 'SetFillColor(kCyan+2)' 'SetFillStyle(3004)'
        drawOptions HIST        
</hist>
</n_vtxs_4D_over_3D>

<n_vtxs_4D_over_3D_vs_ntrks>
customize 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
legendXY 0.3 0.15 0.7 0.45
histos sumtrks trks0 trksnot0
<sumtrks>
        src= input
        var 'vtx4D_n_good/vtx3D_n_good:Sum$(vtx3D_ntrks)'
        bins 50 0.5 200.5 0 5
        customize 'SetTitle(";N_{trks};N_{vtxs} 4D/N_{vtxs} 3D")'
        legendEntry '#Sigma_{3D-vtxs}'
        drawOptions PE
</sumtrks>
<trks0= sumtrks>
        var 'vtx4D_n_good/vtx3D_n_good:vtx3D_ntrks[0]'
        customize+= SetLineColor(kMagenta+1) SetMarkerColor(kMagenta+1)
        legendEntry '0th vertex'        
</trks0>
<trksnot0= sumtrks>
        var 'vtx4D_n_good/vtx3D_n_good:Sum$(vtx3D_ntrks)-vtx3D_ntrks[0]'
        customize+= SetLineColor(kMagenta+3) SetMarkerColor(kMagenta+3)
        legendEntry 'Other vertices'        
</trksnot0>
</n_vtxs_4D_over_3D_vs_ntrks>

###---Sumpt2
# vtx.trackWeitgh(trk)>0.5 selection
<sumpt2_vtx0_tkw0p5>
customize 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
legendHeader 'TTbar 200PU. track-only #Sigma p_{T}^{2}'
histos nogen3d nogen4d gen3d gen4d
<nogen3d>
        src= input
        var '(vtx3D_sumpt2[0]-gen_sumpt2)/gen_sumpt2'
        cut 'vtx3D_best_dz==0 && vtx3D_ntrks[0]>30'
        bins 100 -1 1
        customize 'SetTitle(";#Sigma_{reco} p_{T}^{2}/#Sigma_{gen} p_{T}^{2}-1;Fraction of events")' 'SetLineColor(kBlue+1)'
        legendEntry '3D' 'l'
        drawOptions HIST
</nogen3d>
<gen3d= nogen3d>
        var '(vtx3D_sumpt2_genmatch[0]-gen_sumpt2)/gen_sumpt2'
        customize+= 'SetFillColor(kBlue+1)' 'SetFillStyle(3004)' 'SetLineStyle(7)'
        legendEntry '3D, gen-matched tracks' 'l'
</gen3d>
<nogen4d= nogen3d>
        var '(vtx4D_sumpt2[0]-gen_sumpt2)/gen_sumpt2'
        cut 'vtx4D_best_dz==0 && vtx3D_ntrks[0]>30'        
        customize 'SetLineColor(kRed+1)'
        legendEntry '4D' 'l'        
</nogen4d>
<gen4d= nogen4d>
        var '(vtx4D_sumpt2_genmatch[0]-gen_sumpt2)/gen_sumpt2'
        customize+= 'SetFillColor(kRed+1)' 'SetFillStyle(3004)' 'SetLineStyle(7)'
        legendEntry '4D, gen-matched tracks' 'l'
</gen4d>
</sumpt2_vtx0_tkw0p5>

# dz/dzdt selection
<sumpt2_vtx0_dzdt= sumpt2_vtx0_tkw0p5>
histos nogen3d nogen4d
nogen3d.var '(vtx3D_0_dz_sumpt2-gen_sumpt2)/gen_sumpt2'
nogen4d.var '(vtx4D_0_dzdt_sumpt2-gen_sumpt2)/gen_sumpt2'
</sumpt2_vtx0_dzdt>

<sumpt2_vtx0_dzdt_genmatch= sumpt2_vtx0_tkw0p5>
histos nogen3d nogen4d
nogen3d.var '(vtx3D_0_dz_genm_sumpt2-gen_sumpt2)/gen_sumpt2'
nogen4d.var '(vtx4D_0_dzdt_genm_sumpt2-gen_sumpt2)/gen_sumpt2'
</sumpt2_vtx0_dzdt_genmatch>

<sumpt2_vtx0_diff= sumpt2_vtx0_tkw0p5>
histos nogen3d nogen4d
nogen3d.var '(vtx3D_0_dz_sumpt2-vtx3D_0_dz_genm_sumpt2)/gen_sumpt2'
nogen3d.bins 100 0 1
nogen3d.customize+= 'Scale(1./this->GetEntries())'
nogen4d.var '(vtx4D_0_dzdt_sumpt2-vtx4D_0_dzdt_genm_sumpt2)/gen_sumpt2'
nogen4d.bins 100 0 1
nogen4d.customize+= 'Scale(1./this->GetEntries())'
</sumpt2_vtx0_diff>

# dz/dzdt + track weight > 0.5 selection
<sumpt2_vtx0_dzdt_tkw0p5= sumpt2_vtx0_tkw0p5>
histos nogen3d nogen4d
nogen3d.var '(vtx3D_0_dz_tkw_sumpt2-gen_sumpt2)/gen_sumpt2'
nogen4d.var '(vtx4D_0_dzdt_tkw_sumpt2-gen_sumpt2)/gen_sumpt2'
</sumpt2_vtx0_dzdt_tkw0p5>

# CMSSW vtx score
<sumpt2_vtx0_score>
customize 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
histos h3d h4d
<h3d>
        src= input
        var 'vtx3D_score_sumpt2[0]/gen_sumpt2'
        cut '1./Entries$'
        bins 100 0 10
        customize 'SetTitle(";#Sigma_{tracks-reco} p_{T}^{2}/#Sigma_{tracks-gen} p_{T}^{2};Fraction of events")' 'SetLineColor(kBlue+1)'
        legendEntry '3D' 'l'
        drawOptions HIST
</h3d>
<h4d= h3d>
        var 'vtx4D_score_sumpt2[0]/gen_sumpt2'
        customize 'SetLineColor(kRed+1)'
        legendEntry '4D' 'l'        
</h4d>
</sumpt2_vtx0_score>

<sumpt2_vtx0_score_comp>
customize 'SetLogy()' 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
histos h4d_over_3d
<h4d_over_3d>
        src= input
        var 'vtx4D_score_sumpt2[0]/vtx3D_score_sumpt2[0]'
        cut '1./Entries$'
        bins 200 0.5 1.5
        customize 'SetTitle(";Vertex score (4D/3D);Fraction of events")' 'SetLineColor(kCyan+2)' 'SetMinimum(0.0001)'
        legendEntry '0th vtx' 'l'
        drawOptions HIST
</h4d_over_3d>
</sumpt2_vtx0_score_comp>

###---dt selection check
<track_dt_over_sigmat>
histos ratio ratio_gen
<ratio>
        src= input_trks
        var '(trk_PID_t-pv4d_t)/0.035'
        cut 'fabs(trk_genVtx_z-pv4d_t)<0.05 && fabs(trk_z-pv4d_t)<0.1 && trk_PID_sigmat > -1'
        bins 100 -5 5
        customize 'SetTitle(";#Deltat/(0.035 ns);Events")'
</ratio>
<ratio_gen= ratio>
        cut 'fabs(trk_z-pv4d_t)<0.1 && trk_PID_sigmat > -1 && trk_genDR<0.03 && fabs(trk_genPt/trk_pt-1)<0.1'
        customize+= 'SetLineColor(kRed)' 
</ratio_gen>
</track_dt_over_sigmat>

<track_dt_over_sigmat_vs_pt= track_dt_over_sigmat>
<ratio>
        operation 'FitSlicesY(trks_tree, 2)'
        var '(trk_PID_t-pv4d_t)/0.035:trk_pt'
        bins 100 0 100 100 -5 5
        customize 'SetTitle(";p_{T};#Deltat/(0.035 ns);Events")'
        drawOptions COLZ
</ratio>
<ratio_gen>
        operation 'FitSlicesY(trks_tree, 2)'
        var '(trk_PID_t-pv4d_t)/0.035:trk_pt'
        bins 100 0 100 100 -5 5
        customize 'SetTitle(";p_{T};#Deltat/(0.035 ns);Events")'
        drawOptions COLZ
</ratio_gen>
</track_dt_over_sigmat_vs_pt>

<track_dtOsigmat_gt3_vs_pt>
histos btl etl
<btl>
        src= input_trks
        var 'fabs(trk_PID_t-pv4d_t)/0.035<3:trk_pt'
        cut 'fabs(trk_z-pv4d_t)<0.1 && trk_PID_sigmat > -1 && trk_genDR<0.03 && fabs(trk_genPt/trk_pt-1)<0.05 && fabs(trk_genVtx_z-pv4d_t)<0.05 && fabs(trk_eta)<1.5'        
        bins 20 0 10 0 2
        customize 'SetTitle(";p_{T};#Deltat/(0.035 ns);Events")' 'SetAxisRange(0, 1, "Y")' 'SetMarkerColor(kMagenta+1)'
        legendEntry 'BTL' 'p'        
        drawOptions HIST
</btl>
<etl= btl>
        cut 'fabs(trk_z-pv4d_t)<0.1 && trk_PID_sigmat > -1 && trk_genDR<0.03 && fabs(trk_genPt/trk_pt-1)<0.05 && fabs(trk_genVtx_z-pv4d_t)<0.05 && fabs(trk_eta)>1.5'
        customize  'SetMarkerColor(kCyan+1)'
        legendEntry 'ETL' 'p'
</etl>
</track_dtOsigmat_gt3_vs_pt>

### Dz
<vtx_dz>
histos dz3d dz4d
<dz3d>
        src= input
        var 'vtx3D_z[0]-gen_z'
        cut 'vtx3D_best_dz==0'
        bins 100 -0.01 0.01
        customize 'SetTitle(";#Deltaz;Fraction of events")' 'SetLineColor(kBlue+1)' 'Scale(1./this->GetEntries())' 'GetXaxis()->SetNdivisions(507)'
        drawOptions HIST
</dz3d>
<dz4d= dz3d>
        var 'vtx4D_z[0]-gen_z'
        cut 'vtx4D_best_dz==0'        
        customize 'SetLineColor(kRed+1)' 'Scale(1./this->GetEntries())'
</dz4d>
</vtx_dz>

ntrks_bins 0 20 30 40 50 60 70 80 90 100 110 120 130 140 150 170 200
<vtx_dz_vs_ntrks>
customize 'SetLogy()' 'SetGrid()'
histos dz3d dz4d
<dz3d>
        src= input
        operation 'FitSlicesY(vtxs_tree, 2)'
        var 'vtx3D_z[0]-gen_z:vtx3D_ntrks[0]'
        cut 'vtx3D_best_dz==0'
        #bins 25 0 200 100 -0.01 0.01
        dbins ntrks_bins 100 -0.01 0.01
        customize 'SetTitle(";#Deltaz;Fraction of events")' 'SetLineColor(kBlue+1)' 'SetMarkerColor(kBlue+1)' 'SetMinimum(0.0001)'
        drawOptions PE
</dz3d>
<dz4d= dz3d>
        var 'vtx4D_z[0]-gen_z:vtx4D_ntrks[0]'
        cut 'vtx4D_best_dz==0'        
        customize 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'
</dz4d>
</vtx_dz_vs_ntrks>

<vtx_dz_vs_ntrks_chi2= vtx_dz_vs_ntrks>
customize 'SetGrid()'
dz3d.operation  'FitSlicesY(vtxs_tree, chi2)'
dz4d.operation  'FitSlicesY(vtxs_tree, chi2)'
</vtx_dz_vs_ntrks_chi2>

### Dt
<vtx_dt>
histos dt
<dt>
        src= input
        var 'vtx4D_t[0]-gen_t'
        cut '1./Entries$*(vtx4D_best_dz==0)'
        bins 100 -0.1 0.1
        customize 'SetTitle(";#Deltat;Fraction of events")' 'SetLineColor(kRed+1)' 'GetXaxis()->SetNdivisions(507)'
        drawOptions HIST
</dt>
</vtx_dt>

<vtx_dt_vs_ntrks= vtx_dt>
<dt>
        operation 'FitSlicesY(vtxs_tree, 2)'
        var 'vtx4D_t[0]-gen_t:vtx4D_ntrks[0]'
        bins 100 0 200 100 -0.1 0.1
        customize 'SetTitle(";N_{trks};#Deltat")'
        drawOptions 'PE'
</dt>        
</vtx_dt_vs_ntrks>

###---track gen matching
<track_genmatch_vs_ntrks>
histos dr
<dr>
        src= input_trks
        var 'Sum$(trk_genDR<0.03 && fabs(trk_genPt/trk_pt-1)<0.05 && (fabs(trk_z-trk_genVtx_z)<0.1))/Sum$(fabs(trk_z-pv4d_z)<0.1):n_gen_charged'
        bins 50 0 200 0 10
        customize 'SetTitle(";N_{charged} gen;Fraction of gen-mathched tracks;")' 'GetYaxis()->SetRangeUser(0, 1)'
        drawOptions PE
</dr>
</track_genmatch_vs_ntrks>

<track_genmatch_vs_gencharged>
customize 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1, 1)'
histos map
<map>
        src= input_trks
        var 'Sum$(trk_genDR<0.03 && fabs(trk_genPt/trk_pt-1)<0.05):n_gen_charged'
#        cut '1/Sum$(fabs(trk_z-vtx_0_z)<0.1'
        bins 50 0 200 50 0 200
        customize 'SetTitle(";N_{charged} gen;N_{trks} gen-matched")' 'SetContour(10000)'
        drawOptions COLZ
</map>
</track_genmatch_vs_gencharged>

<track_genmatch_over_gencharged>
customize 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1, 1)'
histos rt
<rt>
        src= input_trks
        var 'Sum$(trk_genDR<0.03 && fabs(trk_genPt/trk_pt-1 )<0.05 && fabs(trk_z-trk_genVtx_z)<0.1)/n_gen_charged'
        bins 100 0 2
        customize 'SetTitle(";N_{trks} gen-matched/N_{charged} gen")'
        drawOptions HIST
</rt>
</track_genmatch_over_gencharged>

## N_tracks vs linden
## WP90
<track_pu_vs_linden_wp90>
customize 'SetGrid()' 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. |#eta^{track}|<3'
legendXY 0.2 0.6 0.4 0.9
histos h3d h4d h1mm hdzdt
<h3d>
        src= input_trks
        var 'Sum$(!trk_simIsFromPV && fabs(trk_eta)<3 && trk_puid_3D>0.7231282 && fabs(trk_z-pv3d_z)<1.):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
        cut 'pv3d_valid && fabs(pv3d_z-trk_genVtx_z)<0.01'
        bins 10 0 1.9 0 1000
        customize 'SetTitle(";Line density (mm^{-1}); Number of PU tracks;")' 'SetLineColor(kBlue+1)' 'SetMarkerColor(kBlue+1)' 'SetAxisRange(0, 50, "Y")'
        legendEntry 'No MTD' 'pl'
        drawOptions PEX
</h3d>
<h4d= h3d>
        var 'Sum$(!trk_simIsFromPV && fabs(trk_eta)<3 && trk_puid_4D>0.74811333 && fabs(trk_z-pv3d_z)<1.):200*TMath::Gaus(abs(10*pv4d_z), 0, 42., 1)'
        cut 'pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01'                                           
        customize 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'
        legendEntry 'MTD #sigma_t=35 ps' 'pl'       
</h4d>
<h1mm= h3d>
        var 'Sum$(!trk_simIsFromPV && fabs(trk_z-pv3d_z)<0.1 && fabs(trk_eta)<3):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
        customize 'SetLineColor(kCyan+1)' 'SetMarkerColor(kCyan+1)'
        legendEntry 'dz < 1 mm' 'pl'       
</h1mm>
<hdzdt= h3d>
        var 'Sum$(!trk_simIsFromPV && fabs(trk_z-pv3d_z)<0.1 && (fabs(trk_PID_t-pv4d_t)<(0.035*3) || trk_PID_sigmat<0) && fabs(trk_eta)<3):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
        customize 'SetLineColor(kOrange+1)' 'SetMarkerColor(kOrange+1)'
        legendEntry 'dz < 1 mm + dt < 3#sigma_{t}' 'pl'       
</hdzdt>
</track_pu_vs_linden_wp90>

<track_eff_vs_linden_wp90>
customize 'SetGrid()' 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. |#eta^{track}|<3'
legendXY 0.2 0.25 0.4 0.55
histos h3d h4d h1mm hdzdt
<h3d>
        src= input_trks
        var 'trk_puid_3D>0.7231282:200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
        cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)<3 && pv3d_valid && fabs(pv3d_z-trk_genVtx_z)<0.01 && trk_simIsFromPV'
        bins 10 0 1.9 0. 1.1
        customize 'SetTitle(";Line density (mm^{-1}); PV-tracks efficiency;")' 'SetLineColor(kBlue+1)' 'SetMarkerColor(kBlue+1)' 'SetAxisRange(0, 1.01, "Y")'
        legendEntry 'No MTD' 'pl'
        drawOptions PEX
</h3d>
<h4d= h3d>
        var 'trk_puid_4D>0.74811333:200*TMath::Gaus(abs(10*pv4d_z), 0, 42., 1)'
        cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 && trk_simIsFromPV'
        customize 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'
        legendEntry 'MTD #sigma_t=35 ps' 'pl'       
</h4d>
<h1mm= h3d>
        var 'fabs(trk_z-pv3d_z)<0.1:200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
        customize 'SetLineColor(kCyan+1)' 'SetMarkerColor(kCyan+1)'
        legendEntry 'dz < 1 mm' 'pl'       
</h1mm>
<hdzdt= h3d>
        var 'fabs(trk_z-pv3d_z)<0.1 && (fabs(trk_PID_t-pv4d_t)<(0.035*3) || trk_PID_sigmat<0):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
        customize 'SetLineColor(kOrange+1)' 'SetMarkerColor(kOrange+1)'
        legendEntry 'dz < 1 mm + dt < 3#sigma_{t}' 'pl'       
</hdzdt>
</track_eff_vs_linden_wp90>

## vs Eta
<track_pu_vs_eta_wp90>
customize 'SetGrid()' 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. |#eta^{track}|<3'
legendXY 0.2 0.6 0.4 0.9
histos h3d h4d h1mm hdzdt
<h3d>
        src= input_trks
        var 'trk_puid_3D>0.7231282:trk_eta'
        cut '!trk_simIsFromPV && fabs(trk_eta)<3 && pv3d_valid && fabs(pv3d_z-trk_genVtx_z)<0.01 && fabs(trk_z-pv3d_z)<1.'
        bins 10 -3 3 0 1
        customize 'SetTitle(";#eta; PU-tracks fake-rate;")' 'SetLineColor(kBlue+1)' 'SetMarkerColor(kBlue+1)' 'SetAxisRange(0, 0.2, "Y")'
        legendEntry 'No MTD' 'pl'
        drawOptions PEX
</h3d>
<h4d= h3d>
        var 'trk_puid_4D>0.74811333:trk_eta'
        cut '!trk_simIsFromPV && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 && fabs(trk_z-pv3d_z)<1.'  
        customize 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'
        legendEntry 'MTD #sigma_t=35 ps' 'pl'       
</h4d>
<h1mm= h3d>
        var 'fabs(trk_z-pv3d_z)<0.1:trk_eta'
        customize 'SetLineColor(kCyan+1)' 'SetMarkerColor(kCyan+1)'
        legendEntry 'dz < 1 mm' 'pl'       
</h1mm>
<hdzdt= h3d>
        var 'fabs(trk_z-pv3d_z)<0.1 && (fabs(trk_PID_t-pv4d_t)<(0.035*3) || trk_PID_sigmat<0):trk_eta'
        customize 'SetLineColor(kOrange+1)' 'SetMarkerColor(kOrange+1)'
        legendEntry 'dz < 1 mm + dt < 3#sigma_{t}' 'pl'       
</hdzdt>
</track_pu_vs_eta_wp90>

<track_eff_vs_eta_wp90>
customize 'SetGrid()' 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. |#eta^{track}|<3'
legendXY 0.2 0.25 0.4 0.55
histos h3d h4d h1mm hdzdt
<h3d>
        src= input_trks
        var 'trk_puid_3D>0.7231282:trk_eta'
        cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)<3 && pv3d_valid && fabs(pv3d_z-trk_genVtx_z)<0.01 && trk_simIsFromPV'
        bins 10 -3 3 0. 1.1
        customize 'SetTitle(";#eta; PV-tracks efficiency;")' 'SetLineColor(kBlue+1)' 'SetMarkerColor(kBlue+1)' 'SetAxisRange(0, 1.01, "Y")'
        legendEntry 'No MTD' 'pl'
        drawOptions PEX
</h3d>
<h4d= h3d>
        var 'trk_puid_4D>0.74811333:trk_eta'
        cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 && trk_simIsFromPV'
        customize 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'
        legendEntry 'MTD #sigma_t=35 ps' 'pl'       
</h4d>
<h1mm= h3d>
        var 'fabs(trk_z-pv3d_z)<0.1:trk_eta'
        customize 'SetLineColor(kCyan+1)' 'SetMarkerColor(kCyan+1)'
        legendEntry 'dz < 1 mm' 'pl'       
</h1mm>
<hdzdt= h3d>
        var 'fabs(trk_z-pv3d_z)<0.1 && (fabs(trk_PID_t-pv4d_t)<(0.035*3) || trk_PID_sigmat<0):trk_eta'
        customize 'SetLineColor(kOrange+1)' 'SetMarkerColor(kOrange+1)'
        legendEntry 'dz < 1 mm + dt < 3#sigma_{t}' 'pl'       
</hdzdt>
</track_eff_vs_eta_wp90>

## vs Pt
pt_bins 0.7 1 2 3 4 5 7.5 10
<track_pu_vs_pt_wp90>
customize 'SetGrid()' 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. |#eta^{track}|<3'
legendXY 0.2 0.6 0.4 0.9
histos h3d h4d h1mm hdzdt
<h3d>
        src= input_trks
        var 'trk_puid_3D>0.7231282:trk_pt'
        cut '!trk_simIsFromPV && fabs(trk_eta)<3 && pv3d_valid && fabs(pv3d_z-trk_genVtx_z)<0.01 && fabs(trk_z-pv3d_z)<1.'
        dbins pt_bins 0 1
        customize 'SetTitle(";p_{T}; PU-tracks fake-rate;")' 'SetLineColor(kBlue+1)' 'SetMarkerColor(kBlue+1)' 'SetAxisRange(0, 0.2, "Y")'
        legendEntry 'No MTD' 'pl'
        drawOptions PEX
</h3d>
<h4d= h3d>
        var 'trk_puid_4D>0.74811333:trk_pt'
        cut '!trk_simIsFromPV && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 && fabs(trk_z-pv3d_z)<1.'  
        customize 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'
        legendEntry 'MTD #sigma_t=35 ps' 'pl'       
</h4d>
<h1mm= h3d>
        var 'fabs(trk_z-pv3d_z)<0.1:trk_pt'
        customize 'SetLineColor(kCyan+1)' 'SetMarkerColor(kCyan+1)'
        legendEntry 'dz < 1 mm' 'pl'       
</h1mm>
<hdzdt= h3d>
        var 'fabs(trk_z-pv3d_z)<0.1 && (fabs(trk_PID_t-pv4d_t)<(0.035*3) || trk_PID_sigmat<0):trk_pt'
        customize 'SetLineColor(kOrange+1)' 'SetMarkerColor(kOrange+1)'
        legendEntry 'dz < 1 mm + dt < 3#sigma_{t}' 'pl'       
</hdzdt>
</track_pu_vs_pt_wp90>

<track_eff_vs_pt_wp90>
customize 'SetGrid()' 'macro:FPCanvasStyle(this, "CMS", "", 0, "Phase-2 Simulation", 1)'
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. |#eta^{track}|<3'
legendXY 0.2 0.25 0.4 0.55
histos h3d h4d h1mm hdzdt
<h3d>
        src= input_trks
        var 'trk_puid_3D>0.7231282:trk_pt'
        cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)<3 && pv3d_valid && fabs(pv3d_z-trk_genVtx_z)<0.01 && trk_simIsFromPV'
        dbins pt_bins 0 1
        customize 'SetTitle(";p_{T}; PV-tracks efficiency;")' 'SetLineColor(kBlue+1)' 'SetMarkerColor(kBlue+1)' 'SetAxisRange(0, 1.01, "Y")'
        legendEntry 'No MTD' 'pl'
        drawOptions PEX
</h3d>
<h4d= h3d>
        var 'trk_puid_4D>0.74811333:trk_pt'
        cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 && trk_simIsFromPV'
        customize 'SetLineColor(kRed+1)' 'SetMarkerColor(kRed+1)'
        legendEntry 'MTD #sigma_t=35 ps' 'pl'       
</h4d>
<h1mm= h3d>
        var 'fabs(trk_z-pv3d_z)<0.1:trk_eta'
        customize 'SetLineColor(kCyan+1)' 'SetMarkerColor(kCyan+1)'
        legendEntry 'dz < 1 mm' 'pl'       
</h1mm>
<hdzdt= h3d>
        var 'fabs(trk_z-pv3d_z)<0.1 && (fabs(trk_PID_t-pv4d_t)<(0.035*3) || trk_PID_sigmat<0):trk_eta'
        customize 'SetLineColor(kOrange+1)' 'SetMarkerColor(kOrange+1)'
        legendEntry 'dz < 1 mm + dt < 3#sigma_{t}' 'pl'       
</hdzdt>
</track_eff_vs_pt_wp90>

# WP 95
<track_pu_vs_linden_wp95= track_pu_vs_linden_wp90>
histos h3d h4d
h3d.var 'Sum$(!trk_simIsFromPV && fabs(trk_eta)<3 && trk_puid_3D>0.5263172):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
h4d.var 'Sum$(!trk_simIsFromPV && fabs(trk_eta)<3 && trk_puid_4D>0.5308085):200*TMath::Gaus(abs(10*pv4d_z), 0, 42., 1)'
</track_pu_vs_linden_wp95>

<track_eff_vs_linden_wp95= track_eff_vs_linden_wp90>
histos h3d h4d
h3d.var 'trk_puid_3D>0.5263172:200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
h4d.var 'trk_puid_4D>0.5308085:200*TMath::Gaus(abs(10*pv4d_z), 0, 42., 1)'
</track_eff_vs_linden_wp95>

# WP 80
<track_pu_vs_linden_wp80= track_pu_vs_linden_wp90>
histos h3d h4d
h3d.var 'Sum$(!trk_simIsFromPV && fabs(trk_eta)<3 && trk_puid_3D>0.86078155):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
h4d.var 'Sum$(!trk_simIsFromPV && fabs(trk_eta)<3 && trk_puid_4D>0.88985777):200*TMath::Gaus(abs(10*pv4d_z), 0, 42., 1)'
</track_pu_vs_linden_wp80>

<track_eff_vs_linden_wp80= track_eff_vs_linden_wp90>
histos h3d h4d
h3d.var 'trk_puid_3D>0.86078155:200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
h4d.var 'trk_puid_4D>0.88985777:200*TMath::Gaus(abs(10*pv4d_z), 0, 42., 1)'
</track_eff_vs_linden_wp80>

## Barrel
#WP 90
<track_pu_vs_linden_wp90_barrel= track_pu_vs_linden_wp90>
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. |#eta^{track}|<1.5'
h3d.var 'Sum$(!trk_simIsFromPV && fabs(trk_eta)<1.5 && trk_puid_3D>0.7425):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
h4d.var 'Sum$(!trk_simIsFromPV && fabs(trk_eta)<1.5 && trk_puid_4D>0.7580):200*TMath::Gaus(abs(10*pv4d_z), 0, 42., 1)'
h1mm.var 'Sum$(!trk_simIsFromPV && fabs(trk_z-pv3d_z)<0.1 && fabs(trk_eta)<1.5):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
hdzdt.var 'Sum$(!trk_simIsFromPV && fabs(trk_z-pv3d_z)<0.1 && fabs(trk_PID_t-pv4d_t)<(0.035*3) && fabs(trk_eta)<1.5):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
</track_pu_vs_linden_wp90_barrel>

<track_eff_vs_linden_wp90_barrel= track_eff_vs_linden_wp90>
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. |#eta^{track}|<1.5'
h3d.cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)<1.5 && trk_simIsFromPV'
h4d.cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)<1.5 && trk_simIsFromPV'
h1mm.cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)<1.5 && trk_simIsFromPV'
h1dzdt.cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)<1.5 && trk_simIsFromPV'
</track_eff_vs_linden_wp90_barrel>

## Endcap
#WP 90
<track_pu_vs_linden_wp90_endcap= track_pu_vs_linden_wp90>
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. 1.5<|#eta^{track}|<3'
h3d.var 'Sum$(!trk_simIsFromPV && fabs(trk_eta)>1.5 && fabs(trk_eta)<3 && trk_puid_3D>0.7425):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
h4d.var 'Sum$(!trk_simIsFromPV && fabs(trk_eta)>1.5 && fabs(trk_eta)<3 && trk_puid_4D>0.7580):200*TMath::Gaus(abs(10*pv4d_z), 0, 42., 1)'
h1mm.var 'Sum$(!trk_simIsFromPV && fabs(trk_z-pv3d_z)<0.1 && fabs(trk_eta)>1.5 && fabs(trk_eta)<3):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
hdzdt,var 'Sum$(!trk_simIsFromPV && fabs(trk_z-pv3d_z)<0.1 && fabs(trk_PID_t-pv4d_t)<(0.035*3) && fabs(trk_eta)>1.5 && fabs(trk_eta)<3):200*TMath::Gaus(abs(10*pv3d_z), 0, 42., 1)'
</track_pu_vs_linden_wp90_endcap>

<track_eff_vs_linden_wp90_endcap= track_eff_vs_linden_wp90>
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. |#eta^{track}|>1.5'
h3d.cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)>1.5 && fabs(trk_eta)<3 && trk_simIsFromPV'
h4d.cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)>1.5 && fabs(trk_eta)<3 && trk_simIsFromPV'
h1mm.cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)>1.5 && fabs(trk_eta)<3 && trk_simIsFromPV'
h1dzdt.cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)>1.5 && fabs(trk_eta)<3 && trk_simIsFromPV'
</track_eff_vs_linden_wp90_endcap>

### BDT features inspection
<bdt3D_pvtracks_WP90_dz>
customize 'SetLogy()'
legendHeader 't#bar{t} 200 PU. p_{T}^{track} > 0.7 GeV. |#eta^{track}|<3'
legendXY 0.2 0.75 0.4 0.95
histos all pv pass 
<pass>
        src= input_trks
        var 'trk_z-pv3d_z'
        cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)<3 && pv3d_valid && fabs(pv3d_z-trk_genVtx_z)<0.01  && trk_puid_3D>0.7231282'
        bins 500 -0.5 0.5
        customize 'SetTitle(";dz (cm); Events")' 'SetLineColor(kCyan+1)' 'macro:this->Scale(1/TMath::Max(this->Integral(), 1.))' 'GetYaxis()->SetRangeUser(1e-5, 10.)'
        legendEntry 'Assigned to PV. BDT 3D' l
        drawOptions HIST
</pass>
<all= pass>
        cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)<3 && pv3d_valid && fabs(pv3d_z-trk_genVtx_z)<0.01 '
        customize+= 'SetLineColor(kBlack)'
        legendEntry 'All tracks' l        
</all>
<pv= pass>
        cut 'fabs(trk_z-pv3d_z)<1. && fabs(trk_eta)<3 && pv3d_valid && fabs(pv3d_z-trk_genVtx_z)<0.01 && trk_simIsFromPV'
        customize+= 'SetLineColor(kRed+1)' 'SetFillStyle(3004)' 'SetFillColorAlpha(kRed+1, 0.3)'
        legendEntry 'Gen-mathed tracks' lf
</pv>
</bdt3D_pvtracks_WP90_dz>

<bdt3D_pvtracks_WP90_pt= bdt3D_pvtracks_WP90_dz>
pass.var 'trk_pt'
pass.bins 100 0 10
all.customize+= 'SetTitle(";p_{T} (GeV); Events")'
all.var 'trk_pt'
all.bins 100 0 10
pv.var 'trk_pt'
pv.bins 100 0 10
</bdt3D_pvtracks_WP90_pt>

<bdt3D_pvtracks_WP90_eta= bdt3D_pvtracks_WP90_dz>
customize
pass.var 'trk_eta'
pass.bins 100 -3 3
all.customize+= 'SetTitle(";#eta; Events")'  'GetYaxis()->SetRangeUser(0, 0.04)'
all.var 'trk_eta'
all.bins 100 -3 3
pv.var 'trk_eta'
pv.bins 100 -3 3
</bdt3D_pvtracks_WP90_eta>

<bdt3D_pvtracks_WP90_dxy= bdt3D_pvtracks_WP90_dz>
pass.var '((-(trk_x - trk_genVtx_x) * trk_pt*TMath::Sin(trk_phi) + (trk_y - trk_genVtx_y) * trk_pt*TMath::Cos(trk_phi)) / trk_pt)*10'
pass.bins 100 -1 1
all.customize+= 'SetTitle(";dxy (mm); Events")' 'GetYaxis()->SetRangeUser(1e-5, 10.)'
all.var '((-(trk_x - trk_genVtx_x) * trk_pt*TMath::Sin(trk_phi) + (trk_y - trk_genVtx_y) * trk_pt*TMath::Cos(trk_phi)) / trk_pt)*10'
all.bins 100 -1 1
pv.var '((-(trk_x - trk_genVtx_x) * trk_pt*TMath::Sin(trk_phi) + (trk_y - trk_genVtx_y) * trk_pt*TMath::Cos(trk_phi)) / trk_pt)*10'
pv.bins 100 -1 1
</bdt3D_pvtracks_WP90_dxy>

draw.plots bdt3D_pvtracks_WP90_dz bdt3D_pvtracks_WP90_pt bdt3D_pvtracks_WP90_eta bdt3D_pvtracks_WP90_dxy

## 4D
<bdt4D_pvtracks_WP90_dz= bdt3D_pvtracks_WP90_dz>
customize 'SetLogy()'
histos all pv pass
<pass>
        src= input_trks
        var 'trk_z-pv4d_z'
        cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 && trk_puid_4D>0.74811333'
        bins 500 -0.5 0.5
        customize 'SetTitle(";dz (cm); Events")' 'SetLineColor(kCyan+1)' 'macro:this->Scale(1/TMath::Max(this->Integral(), 1.))' 'GetYaxis()->SetRangeUser(1e-5, 10.)'
        legendEntry 'Assigned to PV. BDT 4D' l        
        drawOptions HIST
</pass>
<all= pass>
        cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 '
        customize+= 'SetLineColor(kBlack)'
        legendEntry 'All tracks' l     
</all>
<pv= pass>
        cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 && trk_puid_4D>0.74811333 && trk_simIsFromPV'        
        customize+= 'SetLineColor(kRed+1)' 'SetFillStyle(3004)' 'SetFillColorAlpha(kRed+1, 0.3)'
        legendEntry 'Gen-matched tracks' lf     
</pv>
</bdt4D_pvtracks_WP90_dz>

<bdt4D_pvtracks_WP90_pt= bdt4D_pvtracks_WP90_dz>
pass.var 'trk_pt'
pass.bins 100 0 10
all.customize+= 'SetTitle(";p_{T} (GeV); Events")'
all.var 'trk_pt'
all.bins 100 0 10
pv.var 'trk_pt'
pv.bins 100 0 10
</bdt4D_pvtracks_WP90_pt>

<bdt4D_pvtracks_WP90_eta= bdt4D_pvtracks_WP90_dz>
customize
pass.var 'trk_eta'
pass.bins 100 -3 3
all.customize+= 'SetTitle(";#eta; Events")' 'GetYaxis()->SetRangeUser(0, 0.04)'
all.var 'trk_eta'
all.bins 100 -3 3
pv.var 'trk_eta'
pv.bins 100 -3 3
</bdt4D_pvtracks_WP90_eta>

<bdt4D_pvtracks_WP90_dt= bdt4D_pvtracks_WP90_dz>
pass.var 'trk_PID_t-pv4d_t'
pass.cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 && trk_puid_4D>0.74811333 && trk_PID_sigmat>0'
pass.bins 100 -1 1
all.customize+= 'SetTitle(";dt (ns); Events")' 'GetYaxis()->SetRangeUser(1e-5, 10.)'
all.var 'trk_PID_t-pv4d_t'
all.cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 && trk_PID_sigmat>0'
all.bins 100 -1 1
pv.var 'trk_PID_t-pv4d_t'
pv.cut 'fabs(trk_z-pv4d_z)<1. && fabs(trk_eta)<3 && pv4d_valid && fabs(pv4d_z-trk_genVtx_z)<0.01 && trk_PID_sigmat>0 && trk_simIsFromPV'
pv.bins 100 -1 1
</bdt4D_pvtracks_WP90_dt>

<bdt4D_pvtracks_WP90_dxy= bdt4D_pvtracks_WP90_dz>
pass.var '((-(trk_x - trk_genVtx_x) * trk_pt*TMath::Sin(trk_phi) + (trk_y - trk_genVtx_y) * trk_pt*TMath::Cos(trk_phi)) / trk_pt)*10'
pass.bins 100 -1 1
all.customize+= 'SetTitle(";dxy (mm); Events")' 'GetYaxis()->SetRangeUser(1e-5, 10.)'
all.var '((-(trk_x - trk_genVtx_x) * trk_pt*TMath::Sin(trk_phi) + (trk_y - trk_genVtx_y) * trk_pt*TMath::Cos(trk_phi)) / trk_pt)*10'
all.bins 100 -1 1
pv.var '((-(trk_x - trk_genVtx_x) * trk_pt*TMath::Sin(trk_phi) + (trk_y - trk_genVtx_y) * trk_pt*TMath::Cos(trk_phi)) / trk_pt)*10'
pv.bins 100 -1 1
</bdt4D_pvtracks_WP90_dxy>

draw.plots+= bdt4D_pvtracks_WP90_dz bdt4D_pvtracks_WP90_pt bdt4D_pvtracks_WP90_eta bdt4D_pvtracks_WP90_dt bdt4D_pvtracks_WP90_dxy